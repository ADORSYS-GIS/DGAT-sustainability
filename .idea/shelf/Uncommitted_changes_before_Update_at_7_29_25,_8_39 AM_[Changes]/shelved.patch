Index: docker-compose.yml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>services:\n  #\n  # ─────────────────────────────── BACKEND ───────────────────────────────\n  #\n  backend:\n    build:\n      context: .\n      dockerfile: ./infrastructure/Dockerfile.backend\n    image: sustainability-backend:latest\n    container_name: sustainability-backend\n    command: [\"/app/sustainability-tool\"]\n    env_file: .env\n    environment:\n      RUST_LOG: \"debug,hyper=info,sea_orm=info\"\n      DATABASE_URL: \"postgres://${POSTGRES_USER}:${POSTGRES_PASSWORD}@db:${POSTGRES_PORT:-5432}/${POSTGRES_DB}\"\n      KEYCLOAK_URL: \"http://keycloak:8080/keycloak\"\n      SERVER_PORT: \"3001\"\n      CORS_ORIGIN: ${CORS_ORIGIN:-https://ec2-16-171-203-85.eu-north-1.compute.amazonaws.com}\n\n    depends_on:\n      db:\n        condition: service_healthy\n      keycloak:\n        condition: service_healthy\n    healthcheck:\n      test: [\"CMD-SHELL\", \"curl http://localhost:3001/health || exit 1\"]\n      interval: 30s\n      timeout: 10s\n      retries: 5\n      start_period: 20s\n    ports:\n      - \"3001:3001\"\n    networks: [tool-net]\n\n  #\n  # ────────────────────────────── POSTGRES ──────────────────────────────\n  #\n  db:\n    image: postgres:16-alpine\n    container_name: sustainability-db\n    environment:\n      POSTGRES_DB:       \"${POSTGRES_DB:-sustainability}\"\n      POSTGRES_USER:     \"${POSTGRES_USER:-postgres}\"\n      POSTGRES_PASSWORD: \"${POSTGRES_PASSWORD:-postgres}\"\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready -U $${POSTGRES_USER}\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n    ports:\n      - \"5433:5432\"\n    networks: [tool-net]\n\n  #\n  # ────────────────────────────── KEYCLOAK ──────────────────────────────\n  #\n  keycloak:\n    image: quay.io/keycloak/keycloak:26.3.1\n    container_name: sustainability-keycloak\n    environment:\n      KC_DB: \"postgres\"\n      KC_DB_URL_HOST: db\n      KC_DB_URL_PORT: 5432\n      KC_DB_URL_DATABASE: \"${POSTGRES_DB:-sustainability}\"\n      KC_DB_USERNAME: \"${POSTGRES_USER:-postgres}\"\n      KC_DB_PASSWORD: \"${POSTGRES_PASSWORD:-postgres}\"\n      KEYCLOAK_ADMIN: \"${KEYCLOAK_ADMIN:-admin}\"\n      KEYCLOAK_ADMIN_PASSWORD: \"${KEYCLOAK_ADMIN_PASSWORD:-admin123}\"\n      KEYCLOAK_REALM: \"sustainability-realm\"\n      KC_PROXY_HEADERS: \"forwarded\"\n      KC_PROXY: \"edge\"\n      KC_FEATURES: \"preview,organization\"\n      # Hostname v2 configuration (replaces deprecated v1 options)\n      KC_HOSTNAME: \"ec2-16-171-203-85.eu-north-1.compute.amazonaws.com\"\n      KC_HOSTNAME_URL: \"http://ec2-16-171-203-85.eu-north-1.compute.amazonaws.com/keycloak\"\n      KC_HOSTNAME_PATH: \"/keycloak\"\n      KC_HOSTNAME_STRICT: \"false\"\n      KC_HTTP_ENABLED: \"true\"\n      # if you also want to allow HTTP, for debugging only\n      # Fernando user password\n      FERNANDO_PASSWORD: \"${FERNANDO_PASSWORD:-SecurePassword123!}\"\n      KC_URL: \"${KC_URL:-ec2-16-171-203-85.eu-north-1.compute.amazonaws.com}\"\n      # Use the nginx certificate paths\n      SSL_CERT_PATH: \"/etc/x509/https/nginx.crt\"\n      SSL_KEY_PATH: \"/etc/x509/https/nginx.key\"\n      KC_SSL_TRUSTSTORE_FILE: \"/opt/keycloak/conf/nginx-truststore.jks\"\n      KC_SSL_TRUSTSTORE_PASSWORD: \"changeit\"\n#    entrypoint: [\"/opt/keycloak/setup-scripts/startup.sh\"]\n    command: [\"start-dev\", \"--import-realm\", \"--spi-import-ignore-unknown=true\", \"--http-relative-path=/keycloak\"]\n    volumes:\n      - ./infrastructure/keycloak:/opt/keycloak/data/import:ro\n      - ./infrastructure/themes/theme-vaam-01.jar:/opt/keycloak/providers/theme-vaam-01.jar\n#      - ./infrastructure/keycloak/setup-scripts:/opt/keycloak/setup-scripts:ro,Z\n      # Mount the same SSL certificates used by the frontend container\n      - ./ssl/nginx.crt:/etc/x509/https/nginx.crt:ro\n      - ./ssl/nginx.key:/etc/x509/https/nginx.key:ro\n    depends_on:\n      db:\n        condition: service_healthy\n    healthcheck:\n      test: [ \"CMD-SHELL\", \"exit 0\" ]\n      interval: 30s\n      timeout: 10s\n      retries: 1\n      start_period: 240s\n    ports:\n      - \"8080:8080\"\n    networks: [tool-net]\n\n  #\n  # ────────────────────────────── USER PWA ──────────────────────────────\n  #\n  frontend:\n    build:\n      context: .\n      dockerfile: ./infrastructure/Dockerfile.frontend\n      args:\n        FE_HOST: \"${FE_HOST:-localhost}\"\n        API_BASE_URL: \"https://ec2-16-171-203-85.eu-north-1.compute.amazonaws.com\"\n        VITE_KEYCLOAK_ISSUER_URI: \"${VITE_KEYCLOAK_ISSUER_URI:-https://ec2-16-171-203-85.eu-north-1.compute.amazonaws.com/keycloak/realms/sustainability-realm}\"\n        VITE_KEYCLOAK_CLIENT_ID: \"${VITE_KEYCLOAK_CLIENT_ID:-sustainability-tool}\"\n        VITE_KEYCLOAK_SCOPES: \"${VITE_KEYCLOAK_SCOPES:-openid profile email}\"\n        VITE_KEYCLOAK_HOME_URL: \"${VITE_KEYCLOAK_HOME_URL:-https://ec2-16-171-203-85.eu-north-1.compute.amazonaws.com}\"\n        VITE_KEYCLOAK_REDIRECT_URI: \"${VITE_KEYCLOAK_REDIRECT_URI:-https://ec2-16-171-203-85.eu-north-1.compute.amazonaws.com/callback}\"\n\n    image: sustainability-frontend:latest\n    container_name: sustainability-frontend\n    depends_on:\n      backend:\n        condition: service_healthy\n      keycloak:\n        condition: service_healthy\n    healthcheck:\n      test: [\"CMD-SHELL\", \"sh -c 'curl -k https://$$FE_HOST/health || exit 1'\"]\n      interval: 30s\n      timeout: 10s\n      retries: 5\n      start_period: 15s\n    ports:\n      - \"80:80\"\n      - \"443:443\"\n    volumes:\n      - ./ssl:/etc/nginx/ssl:ro\n      - ./infrastructure/frontend-entrypoint.sh:/docker-entrypoint.d/40-check-network.sh:ro\n    networks: [tool-net]\n\n\n# ────────────────────────────── VOLUMES / NETS ───────────────────────────\nvolumes:\n  postgres-data:\n  ssl-certs:\n    driver: local\n\nnetworks:\n  tool-net:\n    driver: bridge\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/docker-compose.yml b/docker-compose.yml
--- a/docker-compose.yml	(revision b6e7c172ffdb5376fba5bfc61650c0e40827f4dc)
+++ b/docker-compose.yml	(date 1753773659049)
@@ -89,6 +89,7 @@
     command: ["start-dev", "--import-realm", "--spi-import-ignore-unknown=true", "--http-relative-path=/keycloak"]
     volumes:
       - ./infrastructure/keycloak:/opt/keycloak/data/import:ro
+      - ./infrastructure/scripts:/opt/keycloak/bin
       - ./infrastructure/themes/theme-vaam-01.jar:/opt/keycloak/providers/theme-vaam-01.jar
 #      - ./infrastructure/keycloak/setup-scripts:/opt/keycloak/setup-scripts:ro,Z
       # Mount the same SSL certificates used by the frontend container
Index: frontend/.docker/app/nginx/init-scripts/100-init-project-env-variables.sh
===================================================================
diff --git a/frontend/.docker/app/nginx/init-scripts/100-init-project-env-variables.sh b/frontend/.docker/app/nginx/init-scripts/100-init-project-env-variables.sh
deleted file mode 100644
--- a/frontend/.docker/app/nginx/init-scripts/100-init-project-env-variables.sh	(revision b6e7c172ffdb5376fba5bfc61650c0e40827f4dc)
+++ /dev/null	(revision b6e7c172ffdb5376fba5bfc61650c0e40827f4dc)
@@ -1,8 +0,0 @@
-#!/usr/bin/env sh
-
-set -ex
-
-projectEnvVariables=$(ls -t /usr/share/nginx/html/assets/projectEnvVariables*.js | head -n1)
-envsubst < "$projectEnvVariables" > ./projectEnvVariables_temp
-cp ./projectEnvVariables_temp "$projectEnvVariables"
-rm ./projectEnvVariables_temp
